<Window x:Class="TrafficDesktopApp.Windows.Dashboard"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:general="clr-namespace:TrafficDesktopApp.Controls.General"
      xmlns:controls="clr-namespace:TrafficDesktopApp.Controls.Dashboard"
      xmlns:report="clr-namespace:TrafficDesktopApp.Controls.Report"
      Title="SEID - Dashboard"
      MinWidth="1100"
      MinHeight="720"
      WindowStartupLocation="CenterScreen"
      WindowState="Maximized">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="70"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <general:Header x:Name="Header" Grid.Row="0" Title="Panel de control" />

        <ScrollViewer Grid.Row="1"
              VerticalScrollBarVisibility="Auto"
              HorizontalScrollBarVisibility="Disabled">

            <Grid Margin="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="20"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Style="{StaticResource RefreshButtonStyle}" 
                                Content="Actualizar"
                                Margin="0,0,15,0"
                                Click="Refresh_Click"/>

                        <TextBlock Text="Última actualización: Hace 5 min" 
                                   VerticalAlignment="Center" Foreground="{DynamicResource TextMutedBrush}" Margin="0,0,15,0"/>

                        <report:ReportButton
                                CameraCount="{Binding ActiveCameras}"
                                IncidentsToday="{Binding IncidentsToday}"
                                DailyChartSource="{Binding ElementName=DailyChart}"
                                MonthlyChartSource="{Binding ElementName=MonthlyChart}"
                                RecentIncidents="{Binding ElementName=IncidencesList, Path=Incidents}" />


                    </StackPanel>
                </Grid>

                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <controls:DashboardCard
                        x:Name="CardTotalIncidencias"
                        Grid.Column="0"
                        Margin="0,0,15,0"
                        Title="Incidencias hoy"
                        Value="—"
                        Subtitle=""/>

                    <controls:DashboardCard
                        x:Name="CardTotalCamaras"
                        Grid.Column="1"
                        Margin="0,0,15,0"
                        Title="Cámaras disponibles"
                        Value=""/>

                    <controls:DashboardCard
                        x:Name="CardTotalUsuarios"
                        Grid.Column="2"
                        Title="Usuarios"
                        Value="—"
                        Subtitle=""/>
                </Grid>

                <Grid Grid.Row="4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0"
                            Style="{StaticResource CardBorder}"
                            Margin="0,0,20,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Incidencias en el último día"
                                       Style="{StaticResource SectionTitle}"
                                       Margin="0,0,0,12"/>

                            <controls:LineChart Grid.Row="1" Height="260" x:Name="DailyChart"/>
                        </Grid>
                    </Border>

                    <controls:CamerasList x:Name="CamerasList" Grid.Column="1"/>
                </Grid>

                <Grid Grid.Row="6">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" MinWidth="520"/>
                        <ColumnDefinition Width="*" MinWidth="360"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0"
                            Style="{StaticResource CardBorder}"
                            Margin="0,0,20,0">
                        
                        <controls:IncidentsList x:Name="IncidencesList" Grid.Row="1"/>
                        
                    </Border>

                    <Border Grid.Column="1"
                            Style="{StaticResource CardBorder}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Incidencias en el último mes"
                                       Style="{StaticResource SectionTitle}"
                                       Margin="0,0,0,12"/>

                            <controls:MonthlyBarChart Grid.Row="1" x:Name="MonthlyChart" Height="300"/>
                        </Grid>
                    </Border>
                </Grid>

            </Grid>
        </ScrollViewer>
    </Grid>
</Window>