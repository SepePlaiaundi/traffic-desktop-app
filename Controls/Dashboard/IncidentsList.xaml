<UserControl x:Class="TrafficDesktopApp.Controls.Dashboard.IncidentsList"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helpers="clr-namespace:TrafficDesktopApp.Helpers">

    <UserControl.Resources>
        <!-- Converter para colores de nivel -->
        <helpers:LevelToColorConverter x:Key="LevelToColorConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- HEADER: Title + Link -->
            <RowDefinition Height="Auto"/> <!-- TABLE HEADERS -->
            <RowDefinition Height="*"/>    <!-- LIST -->
        </Grid.RowDefinitions>

        <!-- HEADER: Título y Link -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel VerticalAlignment="Center">
                <TextBlock Text="Últimas incidencias" 
                           FontSize="16" 
                           FontWeight="Bold" 
                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                <TextBlock Text="Incidentes de tráfico reportados en tiempo real" 
                           Foreground="{DynamicResource TextSecondaryBrush}" 
                           FontSize="12"
                           Margin="0,2,0,0"/>
            </StackPanel>

            <Button Grid.Column="1"
                    Content="Ver informe completo →" 
                    Click="BtnViewMore_Click"
                    Style="{StaticResource LinkButton}"
                    FontSize="12"
                    VerticalAlignment="Center"/>
        </Grid>

        <!-- CABECERA DE TABLA -->
        <Border Grid.Row="1" 
                Background="{DynamicResource HoverBackgroundBrush}" 
                BorderBrush="{DynamicResource BorderLightBrush}" 
                BorderThickness="0,1" 
                Padding="12,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>     <!-- Causa -->
                    <ColumnDefinition Width="100"/>   <!-- Carretera -->
                    <ColumnDefinition Width="100"/>   <!-- Provincia -->
                    <ColumnDefinition Width="80"/>    <!-- Nivel -->
                </Grid.ColumnDefinitions>

                <TextBlock Text="INCIDENCIA" FontWeight="SemiBold" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
                <TextBlock Text="CARRETERA" Grid.Column="1" FontWeight="SemiBold" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
                <TextBlock Text="PROVINCIA" Grid.Column="2" FontWeight="SemiBold" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
                <TextBlock Text="NIVEL" Grid.Column="3" FontWeight="SemiBold" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}" HorizontalAlignment="Right"/>
            </Grid>
        </Border>

        <!-- LISTA -->
        <ItemsControl Grid.Row="2" 
                      ItemsSource="{Binding Incidents, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      Margin="0,4,0,0">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="12,12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="80"/>
                            </Grid.ColumnDefinitions>

                            <!-- Causa y Fecha -->
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="{Binding Cause}" 
                                           FontWeight="SemiBold" 
                                           Foreground="{DynamicResource TextPrimaryBrush}" 
                                           FontSize="13"
                                           TextTrimming="CharacterEllipsis"/>
                                <TextBlock Text="{Binding StartDate, StringFormat='{}Iniciado: {0:dd/MM HH:mm}'}" 
                                           FontSize="11" 
                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                           Margin="0,2,0,0"/>
                            </StackPanel>

                            <!-- Carretera -->
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding Road}" 
                                       VerticalAlignment="Center" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource TextSecondaryBrush}"/>

                            <!-- Provincia -->
                            <TextBlock Grid.Column="2" 
                                       Text="{Binding Province}" 
                                       VerticalAlignment="Center" 
                                       FontSize="13" 
                                       Foreground="{DynamicResource TextSecondaryBrush}"/>

                            <!-- Nivel (Badge) -->
                            <Border Grid.Column="3" 
                                    Background="{Binding Level, Converter={StaticResource LevelToColorConverter}}" 
                                    CornerRadius="4" 
                                    Padding="8,2" 
                                    HorizontalAlignment="Right" 
                                    VerticalAlignment="Center">
                                <TextBlock Text="{Binding Level}" 
                                           FontSize="10" 
                                           FontWeight="Bold" 
                                           Foreground="White"/>
                            </Border>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </Grid>
</UserControl>
